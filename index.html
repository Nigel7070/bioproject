<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Vertebral Column Anatomy - Interactive 3D System</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --primary-blue: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --accent-teal: #0891b2;
            --success-green: #059669;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            --border-light: #e2e8f0;
            --border-medium: #cbd5e1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            padding: 50px 40px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 800;
            color: white;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 400;
        }
        
        /* Tab Navigation */
        .tab-navigation {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 30px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-light);
            display: flex;
            gap: 8px;
            overflow-x: auto;
        }
        
        .tab-btn {
            flex: 1;
            min-width: 140px;
            padding: 16px 24px;
            background: transparent;
            border: 2px solid transparent;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }
        
        .tab-btn:hover {
            background: var(--bg-tertiary);
            color: var(--primary-blue);
        }
        
        .tab-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        
        .tab-label {
            display: block;
            font-size: 0.875rem;
            opacity: 0.8;
            margin-top: 4px;
        }
        
        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Viewer Card */
        .viewer-card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-light);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--bg-tertiary);
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .view-badge {
            background: var(--primary-blue);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        #viewer-canvas {
            width: 100%;
            height: 650px;
            border-radius: 10px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid var(--border-light);
            position: relative;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 25px;
        }
        
        .btn {
            font-family: 'Inter', sans-serif;
            padding: 14px 20px;
            background: var(--bg-primary);
            color: var(--primary-blue);
            font-size: 0.95rem;
            font-weight: 600;
            border: 2px solid var(--border-medium);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
        }
        
        .btn-primary {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
        }
        
        /* Info Panel */
        .info-panel {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-light);
            max-height: 811px;
            overflow-y: auto;
        }
        
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }
        
        .info-panel::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 10px;
        }
        
        .info-panel::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 10px;
        }
        
        .panel-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 20px;
        }
        
        .instructions-box {
            background: var(--bg-tertiary);
            padding: 18px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid var(--accent-teal);
        }
        
        .instructions-box h3 {
            color: var(--accent-teal);
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 12px;
        }
        
        .instructions-box p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.7;
        }
        
        .info-section {
            margin-bottom: 25px;
        }
        
        .info-section h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }
        
        .info-section p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.7;
            margin-bottom: 12px;
        }
        
        .info-section ul {
            list-style: none;
            padding: 0;
        }
        
        .info-section li {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.8;
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
        }
        
        .info-section li::before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: var(--primary-blue);
            font-weight: 700;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(37, 99, 235, 0.05));
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-blue);
            margin-top: 15px;
        }
        
        .highlight-box p {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        /* Labels */
        .label-marker {
            position: absolute;
            min-width: 70px;
            padding: 8px 16px;
            background: rgba(37, 99, 235, 0.95);
            color: white;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            z-index: 100;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(37, 99, 235, 0.5);
            border: 2px solid white;
            transition: all 0.2s ease;
            text-align: center;
            white-space: nowrap;
            pointer-events: auto;
        }
        
        .label-marker:hover {
            transform: scale(1.1);
            box-shadow: 
                0 6px 16px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(37, 99, 235, 0.7);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-light);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-blue);
            margin-bottom: 6px;
            line-height: 1;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        /* Quiz Section */
        .quiz-card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-light);
        }
        
        .quiz-card h2 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .question {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid var(--border-light);
        }
        
        .question h3 {
            color: var(--text-primary);
            margin-bottom: 16px;
            font-size: 1.05rem;
            font-weight: 600;
            line-height: 1.6;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option {
            padding: 14px 18px;
            background: var(--bg-primary);
            border: 2px solid var(--border-light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            color: var(--text-primary);
        }
        
        .option:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary-blue);
            transform: translateX(6px);
        }
        
        .option.correct {
            background: #d1fae5;
            border-color: var(--success-green);
            color: #065f46;
        }
        
        .option.incorrect {
            background: #fee2e2;
            border-color: #dc2626;
            color: #991b1b;
        }
        
        .score-display {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
            border-radius: 12px;
            margin-top: 30px;
            border: 2px solid var(--primary-blue);
        }
        
        .score-display h3 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .score-number {
            font-size: 5rem;
            font-weight: 900;
            color: var(--primary-blue);
            line-height: 1;
        }
        
        .score-percentage {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-top: 15px;
            font-weight: 600;
        }
        
        footer {
            text-align: center;
            padding: 40px;
            color: var(--text-tertiary);
            margin-top: 50px;
            border-top: 1px solid var(--border-light);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            #viewer-canvas {
                height: 450px;
            }
            
            .controls {
                grid-template-columns: 1fr 1fr;
            }
            
            .tab-navigation {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Vertebral Column Anatomy</h1>
            <p class="subtitle">Complete Interactive 3D Educational System</p>
        </header>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">4</div>
                <div class="stat-label">3D Models</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">33</div>
                <div class="stat-label">Total Vertebrae</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">40+</div>
                <div class="stat-label">Labeled Parts</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">360Â°</div>
                <div class="stat-label">Rotation</div>
            </div>
        </div>
        
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('atlas')">
                <div>Atlas (C1)</div>
                <span class="tab-label">First Cervical</span>
            </button>
            <button class="tab-btn" onclick="switchTab('axis')">
                <div>Axis (C2)</div>
                <span class="tab-label">Second Cervical</span>
            </button>
            <button class="tab-btn" onclick="switchTab('cervical')">
                <div>Cervical</div>
                <span class="tab-label">Typical C3-C7</span>
            </button>
            <button class="tab-btn" onclick="switchTab('spine')">
                <div>Full Spine</div>
                <span class="tab-label">Complete Column</span>
            </button>
        </div>
        
        <div class="main-grid">
            <div class="viewer-card">
                <div class="card-header">
                    <h2 class="card-title" id="viewerTitle">Atlas (C1) Vertebra</h2>
                    <span class="view-badge">Interactive 3D</span>
                </div>
                <div id="viewer-canvas"></div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="toggleLabels()">
                        <span id="labelBtn">Hide Labels</span>
                    </button>
                    <button class="btn" onclick="resetView()">
                        <span>Reset View</span>
                    </button>
                    <button class="btn" onclick="toggleRotation()">
                        <span id="rotateBtn">Pause Rotation</span>
                    </button>
                    <button class="btn" onclick="toggleColors()">
                        <span id="colorBtn">Color Parts</span>
                    </button>
                </div>
            </div>
            
            <div class="info-panel" id="infoPanel">
                <!-- Content will be dynamically updated -->
            </div>
        </div>
        
        <div class="quiz-card">
            <h2>Knowledge Assessment - Vertebral Column</h2>
            
            <div class="question" data-answer="0">
                <h3>1. What makes the Atlas (C1) vertebra unique?</h3>
                <div class="options">
                    <div class="option" onclick="checkAnswer(this, 0, 0)">A) It has no vertebral body</div>
                    <div class="option" onclick="checkAnswer(this, 0, 1)">B) It has the longest spinous process</div>
                    <div class="option" onclick="checkAnswer(this, 0, 2)">C) It has costal facets</div>
                    <div class="option" onclick="checkAnswer(this, 0, 3)">D) It is the largest vertebra</div>
                </div>
            </div>
            
            <div class="question" data-answer="2">
                <h3>2. What is the dens (odontoid process)?</h3>
                <div class="options">
                    <div class="option" onclick="checkAnswer(this, 1, 0)">A) Part of the atlas</div>
                    <div class="option" onclick="checkAnswer(this, 1, 1)">B) Part of the sacrum</div>
                    <div class="option" onclick="checkAnswer(this, 1, 2)">C) A peg-like projection on the axis (C2)</div>
                    <div class="option" onclick="checkAnswer(this, 1, 3)">D) A ligament</div>
                </div>
            </div>
            
            <div class="question" data-answer="1">
                <h3>3. Which vertebrae have transverse foramina?</h3>
                <div class="options">
                    <div class="option" onclick="checkAnswer(this, 2, 0)">A) All vertebrae</div>
                    <div class="option" onclick="checkAnswer(this, 2, 1)">B) Only cervical vertebrae (C1-C7)</div>
                    <div class="option" onclick="checkAnswer(this, 2, 2)">C) Only thoracic vertebrae</div>
                    <div class="option" onclick="checkAnswer(this, 2, 3)">D) Only lumbar vertebrae</div>
                </div>
            </div>
            
            <div class="question" data-answer="3">
                <h3>4. What passes through the vertebral foramen?</h3>
                <div class="options">
                    <div class="option" onclick="checkAnswer(this, 3, 0)">A) Blood vessels only</div>
                    <div class="option" onclick="checkAnswer(this, 3, 1)">B) Nerves only</div>
                    <div class="option" onclick="checkAnswer(this, 3, 2)">C) Muscles</div>
                    <div class="option" onclick="checkAnswer(this, 3, 3)">D) Spinal cord</div>
                </div>
            </div>
            
            <div class="question" data-answer="0">
                <h3>5. How many cervical vertebrae are in the human spine?</h3>
                <div class="options">
                    <div class="option" onclick="checkAnswer(this, 4, 0)">A) 7 vertebrae</div>
                    <div class="option" onclick="checkAnswer(this, 4, 1)">B) 12 vertebrae</div>
                    <div class="option" onclick="checkAnswer(this, 4, 2)">C) 5 vertebrae</div>
                    <div class="option" onclick="checkAnswer(this, 4, 3)">D) 4 vertebrae</div>
                </div>
            </div>
            
            <div class="question" data-answer="1">
                <h3>6. Which vertebrae articulate with the ribs?</h3>
                <div class="options">
                    <div class="option" onclick="checkAnswer(this, 5, 0)">A) Cervical vertebrae</div>
                    <div class="option" onclick="checkAnswer(this, 5, 1)">B) Thoracic vertebrae (T1-T12)</div>
                    <div class="option" onclick="checkAnswer(this, 5, 2)">C) Lumbar vertebrae</div>
                    <div class="option" onclick="checkAnswer(this, 5, 3)">D) Sacral vertebrae</div>
                </div>
            </div>
            
            <div class="question" data-answer="2">
                <h3>7. Why are lumbar vertebrae larger than cervical vertebrae?</h3>
                <div class="options">
                    <div class="option" onclick="checkAnswer(this, 6, 0)">A) They produce more blood cells</div>
                    <div class="option" onclick="checkAnswer(this, 6, 1)">B) They have more mobility</div>
                    <div class="option" onclick="checkAnswer(this, 6, 2)">C) They support more body weight</div>
                    <div class="option" onclick="checkAnswer(this, 6, 3)">D) They protect the heart</div>
                </div>
            </div>
            
            <div class="question" data-answer="0">
                <h3>8. What is the total number of vertebrae in the adult spine?</h3>
                <div class="options">
                    <div class="option" onclick="checkAnswer(this, 7, 0)">A) 33 vertebrae</div>
                    <div class="option" onclick="checkAnswer(this, 7, 1)">B) 24 vertebrae</div>
                    <div class="option" onclick="checkAnswer(this, 7, 2)">C) 30 vertebrae</div>
                    <div class="option" onclick="checkAnswer(this, 7, 3)">D) 26 vertebrae</div>
                </div>
            </div>
            
            <div class="question" data-answer="3">
                <h3>9. What movement does the atlantoaxial joint (C1-C2) primarily allow?</h3>
                <div class="options">
                    <div class="option" onclick="checkAnswer(this, 8, 0)">A) Flexion and extension only</div>
                    <div class="option" onclick="checkAnswer(this, 8, 1)">B) Side bending only</div>
                    <div class="option" onclick="checkAnswer(this, 8, 2)">C) No movement</div>
                    <div class="option" onclick="checkAnswer(this, 8, 3)">D) Rotation (head turning side to side)</div>
                </div>
            </div>
            
            <div class="question" data-answer="1">
                <h3>10. Which bone is formed by 5 fused vertebrae?</h3>
                <div class="options">
                    <div class="option" onclick="checkAnswer(this, 9, 0)">A) Coccyx</div>
                    <div class="option" onclick="checkAnswer(this, 9, 1)">B) Sacrum</div>
                    <div class="option" onclick="checkAnswer(this, 9, 2)">C) Atlas</div>
                    <div class="option" onclick="checkAnswer(this, 9, 3)">D) Axis</div>
                </div>
            </div>
            
            <div class="score-display" id="scoreDisplay" style="display: none;">
                <h3>Assessment Results</h3>
                <div class="score-number"><span id="scoreValue">0</span>/10</div>
                <p class="score-percentage" id="scorePercentage">0%</p>
            </div>
        </div>
        
        <footer>
            <p><strong>Complete Vertebral Column Anatomy System</strong></p>
            <p style="margin-top: 8px;">Interactive 3D Educational Tool â€¢ Form 4 Biology Chapter 14</p>
        </footer>
    </div>
    
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        
        let scene, camera, renderer, controls;
        let currentModel;
        let labelMarkers = [];
        let labelsVisible = true;
        let autoRotate = true;
        let showColors = false;
        let currentView = 'atlas';
        const userAnswers = new Array(10).fill(null);
        
        const boneColor = 0xe8dcc8;
        
        // Info content for each view
        const infoContent = {
            atlas: {
                title: 'Atlas (C1) Vertebra',
                description: 'The atlas is the first and most superior cervical vertebra. It is unique because it has no vertebral body, forming a ring-like structure. Named after the Greek titan Atlas who held up the celestial sphere, this vertebra supports the skull.',
                features: [
                    'No vertebral body - unique ring-shaped structure',
                    'Anterior arch with facet for dens articulation',
                    'Posterior arch with groove for vertebral artery',
                    'Large lateral masses bearing the weight of head',
                    'Superior articular facets for occipital condyles',
                    'Transverse processes with transverse foramina',
                    'Allows nodding movements (yes motion)'
                ],
                clinical: 'Jefferson fractures occur from vertical compression. The atlas is crucial for head support and atlanto-occipital joint function.'
            },
            axis: {
                title: 'Axis (C2) Vertebra',
                description: 'The axis is the second cervical vertebra, characterized by its unique dens (odontoid process). This peg-like projection extends upward into the atlas, forming a pivot joint that allows rotation of the head.',
                features: [
                    'Dens (odontoid process) - distinctive peg projection',
                    'Vertebral body supporting the dens',
                    'Bifid spinous process for muscle attachment',
                    'Superior articular facets for atlas articulation',
                    'Transverse processes with foramina',
                    'Forms pivot joint with atlas (C1)',
                    'Allows rotation movements (no motion)'
                ],
                clinical: 'Fractures of the dens are serious injuries. The atlantoaxial joint is essential for head rotation and stability.'
            },
            cervical: {
                title: 'Typical Cervical Vertebra (C3-C7)',
                description: 'Typical cervical vertebrae (C3-C7) are the smallest vertebrae but have unique features. They possess transverse foramina for vertebral arteries and have bifid spinous processes for muscle attachments.',
                features: [
                    'Small vertebral body - oval shaped',
                    'Large triangular vertebral foramen',
                    'Bifid spinous process (except C7)',
                    'Transverse foramina for vertebral arteries',
                    'Superior and inferior articular processes',
                    'Uncinate processes on body margins',
                    'Greatest range of motion in spine'
                ],
                clinical: 'C7 (vertebra prominens) has the most prominent spinous process. Cervical vertebrae are vulnerable to whiplash injuries.'
            },
            spine: {
                title: 'Complete Vertebral Column',
                description: 'The vertebral column consists of 33 vertebrae: 7 cervical, 12 thoracic, 5 lumbar, 5 fused sacral, and 4 fused coccygeal vertebrae. It provides support, protects the spinal cord, and allows movement.',
                features: [
                    'Cervical (C1-C7) - neck region, most mobile',
                    'Thoracic (T1-T12) - chest, articulate with ribs',
                    'Lumbar (L1-L5) - lower back, largest vertebrae',
                    'Sacrum (5 fused) - connects to pelvis',
                    'Coccyx (4 fused) - tailbone, vestigial',
                    'Natural curves: cervical & lumbar lordosis, thoracic & sacral kyphosis',
                    'Intervertebral discs provide cushioning'
                ],
                clinical: 'Spinal curvatures can become abnormal (scoliosis, kyphosis). The column bears body weight and protects vital neural tissue.'
            }
        };
        
        function init() {
            const container = document.getElementById('viewer-canvas');
            
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf8fafc);
            scene.fog = new THREE.Fog(0xf8fafc, 20, 60);
            
            camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(8, 5, 8);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight1.position.set(10, 15, 10);
            directionalLight1.castShadow = true;
            scene.add(directionalLight1);
            
            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
            directionalLight2.position.set(-10, 10, -10);
            scene.add(directionalLight2);
            
            const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);
            fillLight.position.set(0, -5, 0);
            scene.add(fillLight);
            
            const gridHelper = new THREE.GridHelper(20, 20, 0xe2e8f0, 0xf1f5f9);
            gridHelper.position.y = -3;
            scene.add(gridHelper);
            
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 4;
            controls.maxDistance = 25;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 2.0;
            
            buildAtlas();
            updateInfoPanel('atlas');
            
            window.addEventListener('resize', onWindowResize);
            animate();
        }
        
        function buildAtlas() {
            if (currentModel) scene.remove(currentModel);
            clearLabels();
            
            currentModel = new THREE.Group();
            const color = showColors ? 0xffd700 : boneColor;
            const material = new THREE.MeshPhongMaterial({ color: color, shininess: 20 });
            
            // Anterior arch
            const anteriorArch = new THREE.Mesh(
                new THREE.BoxGeometry(1.2, 0.3, 0.25),
                material
            );
            anteriorArch.position.set(0, 0, 1.2);
            anteriorArch.castShadow = true;
            currentModel.add(anteriorArch);
            
            // Posterior arch
            const posteriorArch = new THREE.Mesh(
                new THREE.BoxGeometry(1.5, 0.25, 0.2),
                material
            );
            posteriorArch.position.set(0, 0.2, -1.3);
            posteriorArch.castShadow = true;
            currentModel.add(posteriorArch);
            
            // Lateral masses (left and right)
            const lateralMassGeom = new THREE.BoxGeometry(0.6, 0.5, 0.8);
            
            const lateralMassR = new THREE.Mesh(lateralMassGeom, material);
            lateralMassR.position.set(0.9, 0, 0);
            lateralMassR.castShadow = true;
            currentModel.add(lateralMassR);
            
            const lateralMassL = new THREE.Mesh(lateralMassGeom, material);
            lateralMassL.position.set(-0.9, 0, 0);
            lateralMassL.castShadow = true;
            currentModel.add(lateralMassL);
            
            // Transverse processes
            const transverseGeom = new THREE.BoxGeometry(0.8, 0.15, 0.3);
            
            const transverseR = new THREE.Mesh(transverseGeom, material);
            transverseR.position.set(1.6, -0.1, 0);
            transverseR.castShadow = true;
            currentModel.add(transverseR);
            
            const transverseL = new THREE.Mesh(transverseGeom, material);
            transverseL.position.set(-1.6, -0.1, 0);
            transverseL.castShadow = true;
            currentModel.add(transverseL);
            
            // Vertebral foramen (ring center)
            const foramen = new THREE.Mesh(
                new THREE.TorusGeometry(0.5, 0.1, 16, 32),
                material
            );
            foramen.rotation.x = Math.PI / 2;
            foramen.position.y = 0;
            foramen.castShadow = true;
            currentModel.add(foramen);
            
            scene.add(currentModel);
            
            // Create labels
            createLabels([
                { text: 'Anterior Arch', position: new THREE.Vector3(0, 0, 1.8) },
                { text: 'Posterior Arch', position: new THREE.Vector3(0, 0.4, -1.8) },
                { text: 'Lateral Mass (R)', position: new THREE.Vector3(1.5, 0, 0) },
                { text: 'Lateral Mass (L)', position: new THREE.Vector3(-1.5, 0, 0) },
                { text: 'Transverse Process (R)', position: new THREE.Vector3(2.2, -0.1, 0) },
                { text: 'Transverse Process (L)', position: new THREE.Vector3(-2.2, -0.1, 0) },
                { text: 'Vertebral Foramen', position: new THREE.Vector3(0, -0.5, 0) },
                { text: 'Superior Articular Facet', position: new THREE.Vector3(1.2, 0.5, 0.3) }
            ]);
        }
        
        function buildAxis() {
            if (currentModel) scene.remove(currentModel);
            clearLabels();
            
            currentModel = new THREE.Group();
            const color = showColors ? 0xff8c00 : boneColor;
            const material = new THREE.MeshPhongMaterial({ color: color, shininess: 20 });
            
            // Dens (odontoid process)
            const dens = new THREE.Mesh(
                new THREE.CylinderGeometry(0.25, 0.3, 1.2, 16),
                material
            );
            dens.position.set(0, 1.2, 0.3);
            dens.castShadow = true;
            currentModel.add(dens);
            
            // Vertebral body
            const body = new THREE.Mesh(
                new THREE.CylinderGeometry(0.6, 0.65, 0.7, 16),
                material
            );
            body.position.set(0, 0, 0);
            body.castShadow = true;
            currentModel.add(body);
            
            // Spinous process (bifid)
            const spinousBase = new THREE.Mesh(
                new THREE.BoxGeometry(0.2, 0.2, 1.2),
                material
            );
            spinousBase.position.set(0, 0.1, -1);
            spinousBase.castShadow = true;
            currentModel.add(spinousBase);
            
            // Bifid tips
            const bifidR = new THREE.Mesh(
                new THREE.BoxGeometry(0.15, 0.15, 0.4),
                material
            );
            bifidR.position.set(0.15, 0.1, -1.5);
            currentModel.add(bifidR);
            
            const bifidL = new THREE.Mesh(
                new THREE.BoxGeometry(0.15, 0.15, 0.4),
                material
            );
            bifidL.position.set(-0.15, 0.1, -1.5);
            currentModel.add(bifidL);
            
            // Transverse processes
            const transverseGeom = new THREE.BoxGeometry(0.7, 0.15, 0.3);
            
            const transverseR = new THREE.Mesh(transverseGeom, material);
            transverseR.position.set(1.1, 0, 0);
            transverseR.castShadow = true;
            currentModel.add(transverseR);
            
            const transverseL = new THREE.Mesh(transverseGeom, material);
            transverseL.position.set(-1.1, 0, 0);
            transverseL.castShadow = true;
            currentModel.add(transverseL);
            
            // Pedicles
            const pedicleGeom = new THREE.CylinderGeometry(0.2, 0.2, 0.5, 12);
            
            const pedicleR = new THREE.Mesh(pedicleGeom, material);
            pedicleR.rotation.z = Math.PI / 2;
            pedicleR.position.set(0.6, 0.1, -0.2);
            currentModel.add(pedicleR);
            
            const pedicleL = new THREE.Mesh(pedicleGeom, material);
            pedicleL.rotation.z = Math.PI / 2;
            pedicleL.position.set(-0.6, 0.1, -0.2);
            currentModel.add(pedicleL);
            
            scene.add(currentModel);
            
            createLabels([
                { text: 'Dens (Odontoid)', position: new THREE.Vector3(0, 2, 0.5) },
                { text: 'Vertebral Body', position: new THREE.Vector3(0, -0.5, 0.8) },
                { text: 'Spinous Process', position: new THREE.Vector3(0, 0.3, -2) },
                { text: 'Superior Facet', position: new THREE.Vector3(0.8, 0.5, 0.2) },
                { text: 'Transverse Process (R)', position: new THREE.Vector3(1.6, 0, 0) },
                { text: 'Transverse Process (L)', position: new THREE.Vector3(-1.6, 0, 0) },
                { text: 'Pedicle', position: new THREE.Vector3(1, 0.3, -0.2) },
                { text: 'Vertebral Foramen', position: new THREE.Vector3(0, -0.3, -0.5) }
            ]);
        }
        
        function buildCervical() {
            if (currentModel) scene.remove(currentModel);
            clearLabels();
            
            currentModel = new THREE.Group();
            const color = showColors ? 0x87ceeb : boneColor;
            const material = new THREE.MeshPhongMaterial({ color: color, shininess: 20 });
            
            // Vertebral body
            const body = new THREE.Mesh(
                new THREE.CylinderGeometry(0.5, 0.55, 0.6, 16),
                material
            );
            body.position.set(0, 0, 0);
            body.castShadow = true;
            currentModel.add(body);
            
            // Spinous process (bifid)
            const spinousBase = new THREE.Mesh(
                new THREE.BoxGeometry(0.15, 0.15, 1.0),
                material
            );
            spinousBase.position.set(0, 0.1, -0.9);
            spinousBase.castShadow = true;
            currentModel.add(spinousBase);
            
            const bifidR = new THREE.Mesh(
                new THREE.BoxGeometry(0.12, 0.12, 0.3),
                material
            );
            bifidR.position.set(0.12, 0.1, -1.3);
            currentModel.add(bifidR);
            
            const bifidL = new THREE.Mesh(
                new THREE.BoxGeometry(0.12, 0.12, 0.3),
                material
            );
            bifidL.position.set(-0.12, 0.1, -1.3);
            currentModel.add(bifidL);
            
            // Transverse processes with foramina
            const transverseGeom = new THREE.BoxGeometry(0.7, 0.12, 0.25);
            
            const transverseR = new THREE.Mesh(transverseGeom, material);
            transverseR.position.set(1.0, 0, 0);
            transverseR.castShadow = true;
            currentModel.add(transverseR);
            
            const transverseL = new THREE.Mesh(transverseGeom, material);
            transverseL.position.set(-1.0, 0, 0);
            transverseL.castShadow = true;
            currentModel.add(transverseL);
            
            // Transverse foramina
            const foramenGeom = new THREE.TorusGeometry(0.15, 0.05, 8, 16);
            
            const foramenR = new THREE.Mesh(foramenGeom, material);
            foramenR.rotation.x = Math.PI / 2;
            foramenR.position.set(1.0, 0, 0);
            currentModel.add(foramenR);
            
            const foramenL = new THREE.Mesh(foramenGeom, material);
            foramenL.rotation.x = Math.PI / 2;
            foramenL.position.set(-1.0, 0, 0);
            currentModel.add(foramenL);
            
            // Vertebral arch
            const arch = new THREE.Mesh(
                new THREE.TorusGeometry(0.35, 0.1, 12, 16, Math.PI),
                material
            );
            arch.rotation.x = Math.PI / 2;
            arch.position.set(0, 0.05, -0.3);
            arch.castShadow = true;
            currentModel.add(arch);
            
            // Superior articular processes
            const articularGeom = new THREE.BoxGeometry(0.2, 0.3, 0.2);
            
            const superiorR = new THREE.Mesh(articularGeom, material);
            superiorR.position.set(0.6, 0.4, -0.2);
            currentModel.add(superiorR);
            
            const superiorL = new THREE.Mesh(articularGeom, material);
            superiorL.position.set(-0.6, 0.4, -0.2);
            currentModel.add(superiorL);
            
            scene.add(currentModel);
            
            createLabels([
                { text: 'Vertebral Body', position: new THREE.Vector3(0, -0.5, 0.7) },
                { text: 'Spinous Process', position: new THREE.Vector3(0, 0.2, -1.7) },
                { text: 'Transverse Process (R)', position: new THREE.Vector3(1.5, 0, 0) },
                { text: 'Transverse Process (L)', position: new THREE.Vector3(-1.5, 0, 0) },
                { text: 'Transverse Foramen', position: new THREE.Vector3(1.2, 0.3, 0) },
                { text: 'Superior Articular Process', position: new THREE.Vector3(0.8, 0.8, -0.2) },
                { text: 'Vertebral Foramen', position: new THREE.Vector3(0, -0.3, -0.5) },
                { text: 'Pedicle', position: new THREE.Vector3(0.5, 0.1, 0.1) }
            ]);
        }
        
        function buildFullSpine() {
            if (currentModel) scene.remove(currentModel);
            clearLabels();
            
            currentModel = new THREE.Group();
            let currentY = 0;
            const spacing = 0.7;
            
            // CERVICAL (7)
            for (let i = 0; i < 7; i++) {
                const color = showColors ? 0xffd700 : boneColor;
                const size = 0.8 + i * 0.05;
                const vertebra = createSimpleVertebra(size, currentY, color);
                currentModel.add(vertebra);
                currentY -= spacing;
            }
            
            // THORACIC (12)
            for (let i = 0; i < 12; i++) {
                const color = showColors ? 0x90ee90 : boneColor;
                const size = 1.0 + i * 0.05;
                const vertebra = createSimpleVertebra(size, currentY, color);
                vertebra.position.z = -i * 0.08;
                currentModel.add(vertebra);
                currentY -= spacing;
            }
            
            // LUMBAR (5)
            for (let i = 0; i < 5; i++) {
                const color = showColors ? 0x4169e1 : boneColor;
                const size = 1.5 + i * 0.08;
                const vertebra = createSimpleVertebra(size, currentY, color);
                vertebra.position.z = -0.96 + i * 0.12;
                currentModel.add(vertebra);
                currentY -= spacing * 1.2;
            }
            
            // SACRUM
            const sacrumColor = showColors ? 0xff69b4 : boneColor;
            const sacrum = new THREE.Mesh(
                new THREE.ConeGeometry(1.8, 3.5, 4),
                new THREE.MeshPhongMaterial({ color: sacrumColor, shininess: 20 })
            );
            sacrum.position.y = currentY - 2;
            sacrum.position.z = -0.3;
            sacrum.castShadow = true;
            currentModel.add(sacrum);
            
            // COCCYX
            const coccyxColor = showColors ? 0x9370db : boneColor;
            const coccyx = new THREE.Mesh(
                new THREE.ConeGeometry(0.4, 1.0, 4),
                new THREE.MeshPhongMaterial({ color: coccyxColor, shininess: 20 })
            );
            coccyx.position.y = currentY - 4.5;
            coccyx.position.z = -0.5;
            coccyx.castShadow = true;
            currentModel.add(coccyx);
            
            currentModel.position.y = 8;
            scene.add(currentModel);
            
            createLabels([
                { text: 'Cervical (C1-C7)', position: new THREE.Vector3(2, 8.5, 0) },
                { text: 'Thoracic (T1-T12)', position: new THREE.Vector3(2.5, 3, -1) },
                { text: 'Lumbar (L1-L5)', position: new THREE.Vector3(2.5, -2.5, 0) },
                { text: 'Sacrum (5 fused)', position: new THREE.Vector3(2.5, -6, -0.3) },
                { text: 'Coccyx (4 fused)', position: new THREE.Vector3(1.5, -9, -0.5) }
            ]);
        }
        
        function createSimpleVertebra(size, yPos, color) {
            const vertebra = new THREE.Group();
            const material = new THREE.MeshPhongMaterial({ color: color, shininess: 20 });
            
            // Body
            const body = new THREE.Mesh(
                new THREE.CylinderGeometry(size * 0.4, size * 0.45, size * 0.6, 16),
                material
            );
            body.castShadow = true;
            vertebra.add(body);
            
            // Spinous process
            const spinous = new THREE.Mesh(
                new THREE.BoxGeometry(size * 0.15, size * 0.15, size * 0.9),
                material
            );
            spinous.position.set(0, size * 0.15, -size * 0.6);
            spinous.castShadow = true;
            vertebra.add(spinous);
            
            // Transverse processes
            const transverseR = new THREE.Mesh(
                new THREE.BoxGeometry(size * 0.6, size * 0.12, size * 0.2),
                material
            );
            transverseR.position.set(size * 0.5, size * 0.1, -size * 0.1);
            transverseR.castShadow = true;
            vertebra.add(transverseR);
            
            const transverseL = new THREE.Mesh(
                new THREE.BoxGeometry(size * 0.6, size * 0.12, size * 0.2),
                material
            );
            transverseL.position.set(-size * 0.5, size * 0.1, -size * 0.1);
            transverseL.castShadow = true;
            vertebra.add(transverseL);
            
            vertebra.position.y = yPos;
            return vertebra;
        }
        
        function createLabels(labelData) {
            const container = document.getElementById('viewer-canvas');
            
            labelData.forEach(data => {
                const marker = document.createElement('div');
                marker.className = 'label-marker';
                marker.textContent = data.text;
                marker.style.display = labelsVisible ? 'block' : 'none';
                container.appendChild(marker);
                
                labelMarkers.push({
                    element: marker,
                    position: data.position
                });
            });
        }
        
        function clearLabels() {
            labelMarkers.forEach(label => {
                label.element.remove();
            });
            labelMarkers = [];
        }
        
        function updateLabels() {
            labelMarkers.forEach(label => {
                const vector = label.position.clone();
                vector.project(camera);
                
                const x = (vector.x * 0.5 + 0.5) * renderer.domElement.clientWidth;
                const y = (-(vector.y) * 0.5 + 0.5) * renderer.domElement.clientHeight;
                
                label.element.style.left = x + 'px';
                label.element.style.top = y + 'px';
                label.element.style.transform = 'translate(-50%, -50%)';
                
                if (vector.z > 1 || x < 0 || x > renderer.domElement.clientWidth || y < 0 || y > renderer.domElement.clientHeight) {
                    label.element.style.opacity = '0';
                    label.element.style.pointerEvents = 'none';
                } else {
                    label.element.style.opacity = vector.z > 0.5 ? '0.7' : '1';
                    label.element.style.pointerEvents = 'auto';
                }
            });
        }
        
        function updateInfoPanel(view) {
            const info = infoContent[view];
            const panel = document.getElementById('infoPanel');
            
            let html = `
                <h2 class="panel-title">${info.title}</h2>
                
                <div class="instructions-box">
                    <h3>ðŸŽ® Viewer Controls</h3>
                    <p><strong>Rotate:</strong> Left click + drag<br>
                    <strong>Zoom:</strong> Scroll wheel<br>
                    <strong>Pan:</strong> Right click + drag</p>
                </div>
                
                <div class="info-section">
                    <h3>Overview</h3>
                    <p>${info.description}</p>
                </div>
                
                <div class="info-section">
                    <h3>Key Features</h3>
                    <ul>
                        ${info.features.map(f => `<li>${f}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="highlight-box">
                    <h3 style="font-size: 1rem; font-weight: 700; margin-bottom: 8px;">Clinical Significance</h3>
                    <p>${info.clinical}</p>
                </div>
            `;
            
            panel.innerHTML = html;
        }
        
        function switchTab(view) {
            currentView = view;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.tab-btn').classList.add('active');
            
            // Update viewer title
            const titles = {
                'atlas': 'Atlas (C1) Vertebra',
                'axis': 'Axis (C2) Vertebra',
                'cervical': 'Typical Cervical Vertebra',
                'spine': 'Complete Vertebral Column'
            };
            document.getElementById('viewerTitle').textContent = titles[view];
            
            // Build appropriate model
            switch(view) {
                case 'atlas':
                    buildAtlas();
                    camera.position.set(6, 4, 6);
                    break;
                case 'axis':
                    buildAxis();
                    camera.position.set(6, 4, 6);
                    break;
                case 'cervical':
                    buildCervical();
                    camera.position.set(5, 3, 5);
                    break;
                case 'spine':
                    buildFullSpine();
                    camera.position.set(12, 8, 12);
                    break;
            }
            
            updateInfoPanel(view);
            controls.target.set(0, 0, 0);
            controls.update();
        }
        
        function toggleLabels() {
            labelsVisible = !labelsVisible;
            labelMarkers.forEach(label => {
                label.element.style.display = labelsVisible ? 'block' : 'none';
            });
            document.getElementById('labelBtn').textContent = labelsVisible ? 'Hide Labels' : 'Show Labels';
        }
        
        function toggleColors() {
            showColors = !showColors;
            switchTab(currentView);
            document.getElementById('colorBtn').textContent = showColors ? 'Hide Colors' : 'Color Parts';
        }
        
        function resetView() {
            switch(currentView) {
                case 'atlas':
                case 'axis':
                case 'cervical':
                    camera.position.set(6, 4, 6);
                    break;
                case 'spine':
                    camera.position.set(12, 8, 12);
                    break;
            }
            controls.target.set(0, 0, 0);
            controls.update();
        }
        
        function toggleRotation() {
            autoRotate = !autoRotate;
            controls.autoRotate = autoRotate;
            document.getElementById('rotateBtn').textContent = autoRotate ? 'Pause Rotation' : 'Resume Rotation';
        }
        
        function onWindowResize() {
            const container = document.getElementById('viewer-canvas');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            if (labelsVisible) updateLabels();
            renderer.render(scene, camera);
        }
        
        // Quiz functionality
        function checkAnswer(element, questionIndex, answerIndex) {
            const question = element.closest('.question');
            const options = question.querySelectorAll('.option');
            const correctAnswer = parseInt(question.dataset.answer);
            
            options.forEach(opt => {
                opt.classList.remove('correct', 'incorrect');
                opt.style.pointerEvents = 'none';
            });
            
            const isCorrect = answerIndex === correctAnswer;
            
            if (isCorrect) {
                element.classList.add('correct');
            } else {
                element.classList.add('incorrect');
                options[correctAnswer].classList.add('correct');
            }
            
            userAnswers[questionIndex] = answerIndex;
            
            if (userAnswers.every(ans => ans !== null)) {
                const score = userAnswers.filter((ans, idx) => {
                    const q = document.querySelectorAll('.question')[idx];
                    return ans === parseInt(q.dataset.answer);
                }).length;
                
                const percentage = (score / 10 * 100).toFixed(0);
                document.getElementById('scoreValue').textContent = score;
                document.getElementById('scorePercentage').textContent = percentage + '% Correct';
                document.getElementById('scoreDisplay').style.display = 'block';
                document.getElementById('scoreDisplay').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        
        // Make functions global
        window.switchTab = switchTab;
        window.toggleLabels = toggleLabels;
        window.toggleColors = toggleColors;
        window.resetView = resetView;
        window.toggleRotation = toggleRotation;
        window.checkAnswer = checkAnswer;
        
        // Initialize
        init();
    </script>
</body>
</html>
